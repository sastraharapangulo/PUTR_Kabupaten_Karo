import{c as x,a as S}from"./devEnvironmentUtils-CnNDiFMM.js";import{C as D,I as u,b as c,c_ as w,c$ as v,d0 as F,d1 as O,d2 as P,d3 as A,d4 as N,d5 as U,d6 as M,d7 as R,d8 as W}from"./index-CdyqwYB1.js";import{e as _}from"./webStyleAcceptedFormats-CG7ZQ6BV.js";function J(t,e,l){const a=t.name;return a==null?Promise.reject(new c("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):t.styleName==="Esri2DPointSymbolsStyle"?z(a,e,l):M(t,e,l).then(n=>q(n,a,e,R,l))}function k(t,e){return e.items.find(l=>l.name===t)}async function q(t,e,l,a,n){var f,h;const o=(l==null?void 0:l.portal)!=null?l.portal:D.getDefault(),r={portal:o,url:u(t.baseUrl)},m=k(e,t.data);if(!m)throw new c("symbolstyleutils:symbol-name-not-found",`The symbol name '${e}' could not be found`,{symbolName:e});const b=(n==null?void 0:n.acceptedFormats)??_,p=a(m,b);if(!p)throw new c("symbolstyleutils:symbol-reference-no-accepted-format",`The symbol name '${e}' does not have an accepted format (one of ${b})`,{symbolName:e});const{url:T,format:C}=p;let i=w(T,r),y=((f=m.thumbnail)==null?void 0:f.href)??null;const d=(h=m.thumbnail)==null?void 0:h.imageData;x()&&(i=S(i)??"",y=S(y));const E={portal:o,url:u(v(i)),origin:"portal-item"};return F(i,n).then(g=>{const I=C==="cim"?O(g.data):g.data,s=P(I,E);if(s&&A(s)){if(y){const $=w(y,r);s.thumbnail=new N({url:$})}else d&&(s.thumbnail=new N({url:`data:image/png;base64,${d}`}));t.styleUrl?s.styleOrigin=new U({portal:l.portal,styleUrl:t.styleUrl,name:e}):t.styleName&&(s.styleOrigin=new U({portal:l.portal,styleName:t.styleName,name:e}))}return s})}function z(t,e,l){const a=W.replaceAll(/\{SymbolName\}/gi,t),n=e.portal!=null?e.portal:D.getDefault();return F(a,l).then(o=>{const r=O(o.data);return P(r,{portal:n,url:u(v(a)),origin:"portal-item"})})}export{q as fetchSymbolFromStyle,k as getStyleItemFromStyle,J as resolveWebStyleSymbol};

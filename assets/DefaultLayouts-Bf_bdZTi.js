const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ImageMaterial.glsl-COuETN4q.js","assets/index-D805BexR.js","assets/index-DsnHzo1r.css","assets/elevationInfoUtils-BND2ThQG.js","assets/RouteLayerInteraction-BHgHTjlF.js","assets/GraphicsLayer-D-lMuTGk.js","assets/Stop-21O9Bhwl.js","assets/networkEnums-BGwm4oZ9.js","assets/hitTestSelectUtils-DhQrqoIP.js","assets/quantityUtils-Bgj6D3qT.js","assets/projectVectorToVector-BoTZZlcE.js","assets/projectPointToVector-Cltsd45V.js","assets/geodesicUtils-CTNoXZAy.js","assets/plane-L6qtSBjg.js","assets/mat3f64-q3fE-ZOt.js","assets/mat4f64-Dk4dwAN8.js","assets/quatf64-aQ5IuZRd.js","assets/sphere-CdMHh-xJ.js","assets/automaticLengthMeasurementUtils-DATogWKl.js","assets/MeshTransform-DIYujxNG.js","assets/quat-RTaSMq_Q.js","assets/axisAngleDegrees-jNSQteiL.js","assets/meshVertexSpaceUtils-Wh4dtXYr.js","assets/MeshLocalVertexSpace-t9X9xoeg.js","assets/memoize-DmxaQ-k8.js","assets/unitFormatUtils-BPhBBsg1.js","assets/spatialReferenceEllipsoidUtils-CgiW1lSK.js","assets/geodesicLengthMeasurementUtils-BczpIp-l.js","assets/geometryEngine-BP4jayY0.js","assets/geometryEngineBase-B0ZyeKAX.js","assets/_commonjsHelpers-DCkdB7M8.js","assets/hydrated-D8aVKlUh.js","assets/Octree-CzBrd7yy.js","assets/InterleavedLayout-CVhvZaXk.js","assets/BufferView-jLJ9pYV0.js","assets/types-D0PSWh4d.js","assets/lineSegment-BHWXTQCe.js","assets/RibbonLine.glsl-Rebwl8ne.js","assets/orientedBoundingBox-DstMsDhw.js","assets/computeTranslationToOriginAndRotation-Be3doUwy.js","assets/Geometry-CFCBzhi6.js","assets/renderState-D_XNN6U0.js","assets/basicInterfaces-CZwQPxTp.js","assets/ShaderOutput-DnYY5J1_.js","assets/BindType-BBwFZqyN.js","assets/glsl-BH37Aalp.js","assets/VertexAttribute-Cq4MnHjR.js","assets/boundedPlane-D4h-xIAT.js","assets/requestImageUtils-BxDbQJYe.js","assets/TextureFormat-1mYWTFa-.js","assets/Indices-D7D0yvvJ.js","assets/triangle-CwVXOTlB.js","assets/dehydratedFeatureUtils-BTsxb-SK.js","assets/doublePrecisionUtils-B0owpBza.js","assets/hydratedFeatures-5krhTH0L.js","assets/vec3f32-nZdmKIgz.js","assets/floatRGBA-xUiheES7.js","assets/ShaderBuilder-GHSF3cZN.js","assets/glUtil-BL9HLK4F.js","assets/HUDMaterial-C9JO2CDH.js","assets/VertexArrayObject-Dix4c-39.js","assets/SnappingContext-I5i_YGrt.js","assets/PointSnappingHint-B6YFPPPM.js","assets/earcut-D9gy186-.js","assets/editPlaneUtils-Dbpc5_hx.js","assets/ReactiveSet-ClJg7hgL.js","assets/IntersectorInterfaces-CmNINbyF.js","assets/SelectedVertexTooltipInfo-DG3LuYlH.js","assets/TranslateTooltipInfo-uVadTesx.js","assets/utils-dDkjv_kB.js","assets/cimSymbolUtils-Dkqf8_px.js","assets/persistable-yXyBHTOD.js","assets/multiOriginJSONSupportUtils-C0wm8_Yw.js","assets/resourceExtension-DpW16eP4.js","assets/ExtentScaleTooltipInfo-NN68mmJa.js","assets/GraphicManipulator-5sxV3sS5.js","assets/drapedUtils-Dq5bnJdK.js"])))=>i.map(i=>d[i]);
import{aN as Ge,so as Ht,mq as Zr,jq as Se,B as d,bX as Ie,E as y,F as Q,aJ as De,ak as ht,ds as Pe,aB as $r,ed as ei,hw as Be,mK as Vt,er as ti,e0 as ri,ef as ii,eb as G,ec as si,hJ as ai,d_ as Dt,jh as H,gj as v,_ as J,sp as ni,aF as Xe,aD as $e,c3 as pe,c4 as wt,gL as Qe,cm as Ir,ct as oi,cp as Dr,cr as xe,j8 as ne,aE as Wt,aG as li,or as Pr,iY as Ar,A as hi,jx as Pt,aQ as ci,dV as Ut,dw as ui,mJ as zt,jy as di,hA as gi,eu as Fr,hB as Ct,es as pi,jC as Er,ew as Mr,op as _i,mL as fi,ez as mi,m_ as re,m$ as _e,ma as we,iK as qt,gi as fe,m7 as $,sq as vi,mZ as jt,ol as xi,cJ as yi,df as wi,bS as Ci,cH as Gt,l as bi,sr as Ti,jK as Ce,ss as ct,m0 as Oi,st as Ri,hG as Si,hK as $i,hz as Ii,nO as Di,nd as Pi,iF as Lr,jB as Ai,su as Fi,sv as Ei,dt as Mi,iD as Bt}from"./index-D805BexR.js";import{o as se,e as N}from"./mat4f64-Dk4dwAN8.js";import{C as Li,E as Ni,U as Hi}from"./sphere-CdMHh-xJ.js";import{m as Vi}from"./plane-L6qtSBjg.js";import{s as me,u as Wi,c as oe,f as Ne,H as Ae}from"./InterleavedLayout-CVhvZaXk.js";import{n as D,u as Nr,l as ut,S as kt,e as Ui}from"./ShaderOutput-DnYY5J1_.js";import{au as W,Y as Hr,q as Vr,g as dt,ax as zi,ay as qi,j as Yt,ad as Xt,aT as Qt,am as At,C as U,aH as ji,ap as Fe,al as Wr,ae as it,e as Je,aB as Gi,aU as Ft,F as K,G as Z,ao as Ur,as as Bi,at as gt,aV as ki,O as E,E as Ke,aW as pt,X as ke,aX as Yi,aY as Xi,aZ as Qi,L as A,a_ as Ji,a$ as Ki,P as _t,M as Zi,aR as es,a as ts,ag as rs,aF as is,u as ss,v as as,ai as ns,aG as os,r as ls,z as hs,x as cs,aM as us,aN as ds,aO as gs,aP as ps,H as _s,aJ as fs,aK as ms,aL as vs,I as xs,J as ys,K as ws,aQ as Cs,B as bs,aS as Ts,b0 as Os,b1 as Rs,f as Ss,l as $s,n as Is}from"./Geometry-CFCBzhi6.js";import{a as Oe,e as Et}from"./basicInterfaces-CZwQPxTp.js";import{e as x}from"./VertexAttribute-Cq4MnHjR.js";import{n as w}from"./glsl-BH37Aalp.js";import{i as ee}from"./ShaderBuilder-GHSF3cZN.js";import{B as Y,g as X,c as Mt,f as Ds}from"./renderState-D_XNN6U0.js";import{w as Ps}from"./Indices-D7D0yvvJ.js";import{t as te}from"./orientedBoundingBox-DstMsDhw.js";import{p as Ze,a as zr}from"./triangulationUtils-CNjvK0ZF.js";import{t as As,_ as Fs,a as Es,e as He,C as Ms,b as Jt,u as Ls}from"./RibbonLine.glsl-Rebwl8ne.js";import{r as Ns,i as st,u as Hs}from"./HUDMaterial-C9JO2CDH.js";import{a as qr}from"./BindType-BBwFZqyN.js";import{j as Vs,v as Kt,w as Zt}from"./axisAngleDegrees-jNSQteiL.js";import{E as er}from"./VertexArrayObject-Dix4c-39.js";import{t as Ws}from"./NestedMap-GuqgquCN.js";import{b as Us}from"./dehydratedFeatureUtils-BTsxb-SK.js";import{e as zs}from"./mat3f64-q3fE-ZOt.js";var tr,rr;(function(e){e[e.ADD=0]="ADD",e[e.UPDATE=1]="UPDATE",e[e.REMOVE=2]="REMOVE"})(tr||(tr={})),function(e){e[e.NONE=0]="NONE",e[e.VISIBILITY=1]="VISIBILITY",e[e.GEOMETRY=2]="GEOMETRY",e[e.TRANSFORMATION=4]="TRANSFORMATION",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.OCCLUDEE=16]="OCCLUDEE"}(rr||(rr={}));var k,ir,sr;(function(e){e[e.INNER=0]="INNER",e[e.OUTER=1]="OUTER"})(k||(k={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",e[e.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",e[e.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(ir||(ir={})),function(e){e[e.FADING=0]="FADING",e[e.IMMEDIATE=1]="IMMEDIATE",e[e.UNFADED=2]="UNFADED"}(sr||(sr={}));let ar=class{constructor(){this._extent=Ge(),this.resolution=0,this.renderLocalOrigin=As(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new qs}get extent(){return this._extent}setupGeometryViewsCyclical(t){this.setupGeometryView();const r=.001*t.range;if(this._extent[0]-r<=t.min){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];Ht(this._extent,t.range,0,i)}if(this._extent[2]+r>=t.max){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];Ht(this._extent,-t.range,0,i)}}setupGeometryView(){this.canvasGeometries.numViews=1,Zr(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let t=0;t<this.canvasGeometries.numViews;t++){const r=this.canvasGeometries.extents[t];if(r[0]!==r[2]&&r[1]!==r[3])return!0}return!1}},qs=class{constructor(){this.extents=[Ge(),Ge(),Ge()],this.numViews=0}};var C;(function(e){e[e.Color=0]="Color",e[e.ColorNoRasterImage=1]="ColorNoRasterImage",e[e.Highlight=2]="Highlight",e[e.WaterNormal=3]="WaterNormal",e[e.Occluded=4]="Occluded",e[e.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"})(C||(C={}));let js=class{constructor(t,r,i){this._fbos=t,this._format=r,this._name=i}get valid(){var t;return((t=this._handle)==null?void 0:t.getTexture())!=null}dispose(){this._handle=Se(this._handle)}get texture(){var t;return(t=this._handle)==null?void 0:t.getTexture()}bind(t,r,i){var a,s,n,o;this._handle&&((a=this._handle.fbo)==null?void 0:a.width)===r&&((s=this._handle.fbo)==null?void 0:s.height)===i||((n=this._handle)==null||n.release(),this._handle=this._fbos.acquire(r,i,this._name,this._format)),t.bindFramebuffer((o=this._handle)==null?void 0:o.fbo)}generateMipMap(){var t,r,i,a,s;(i=(r=(t=this._handle)==null?void 0:t.getTexture())==null?void 0:r.descriptor)!=null&&i.hasMipmap&&((s=(a=this._handle)==null?void 0:a.getTexture())==null||s.generateMipmap())}},le=class{constructor(t,r,i,a,s=W.RGBA_MIPMAP){this.output=i,this.content=a,this.fbo=new js(t,s,r)}get valid(){return this.fbo.valid}},Gs=class{constructor(t){this.targets=[new le(t,"overlay color",D.Color,C.Color),new le(t,"overlay IM color",D.Color,C.ColorNoRasterImage),new le(t,"overlay highlight",D.Highlight,C.Highlight,W.RG),new le(t,"overlay water",D.Normal,C.WaterNormal),new le(t,"overlay occluded",D.Color,C.Occluded)],Hr()&&this.targets.push(new le(t,"overlay olid",D.ObjectAndLayerIdColor,C.ObjectAndLayerIdColor,W.RGBA))}getTexture(t){var r;return(r=this.targets[t])==null?void 0:r.fbo.texture}dispose(){for(const t of this.targets)t.fbo.dispose()}computeValidity(){return this.targets.reduce((t,r,i)=>r.valid?t|=1<<i:t,0)}};var nr;(function(e){e[e.Material=0]="Material",e[e.ShadowMap=1]="ShadowMap",e[e.Highlight=2]="Highlight",e[e.ViewshedShadowMap=3]="ViewshedShadowMap"})(nr||(nr={}));var B,et;function Bs(e){return e!=null&&!e.running}(function(e){e[e.Idle=0]="Idle",e[e.Rendering=1]="Rendering",e[e.Ready=2]="Ready",e[e.Fading=3]="Fading"})(B||(B={})),function(e){e[e.RG=0]="RG",e[e.BA=1]="BA",e[e.COUNT=2]="COUNT"}(et||(et={}));var bt;let Ve=bt=class extends De{constructor(e){super(e),this.type="cloudy",this.cloudCover=.5}clone(){return new bt({cloudCover:this.cloudCover})}};d([Ie({cloudy:"cloudy"}),y({json:{write:{isRequired:!0}}})],Ve.prototype,"type",void 0),d([y({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Ve.prototype,"cloudCover",void 0),Ve=bt=d([Q("esri.views.3d.environment.CloudyWeather")],Ve);var Tt;let We=Tt=class extends De{constructor(e){super(e),this.type="foggy",this.fogStrength=.5}clone(){return new Tt({fogStrength:this.fogStrength})}};d([Ie({foggy:"foggy"}),y({json:{write:{isRequired:!0}}})],We.prototype,"type",void 0),d([y({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],We.prototype,"fogStrength",void 0),We=Tt=d([Q("esri.views.3d.environment.FoggyWeather")],We);var Ot;let be=Ot=class extends De{constructor(e){super(e),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new Ot({cloudCover:this.cloudCover,precipitation:this.precipitation})}};d([Ie({rainy:"rainy"}),y({json:{write:{isRequired:!0}}})],be.prototype,"type",void 0),d([y({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],be.prototype,"cloudCover",void 0),d([y({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],be.prototype,"precipitation",void 0),be=Ot=d([Q("esri.views.3d.environment.RainyWeather")],be);var Rt;let he=Rt=class extends De{constructor(e){super(e),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new Rt({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};d([Ie({snowy:"snowy"}),y({json:{write:{isRequired:!0}}})],he.prototype,"type",void 0),d([y({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],he.prototype,"cloudCover",void 0),d([y({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],he.prototype,"precipitation",void 0),d([y({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],he.prototype,"snowCover",void 0),he=Rt=d([Q("esri.views.3d.environment.SnowyWeather")],he);var St;let Ue=St=class extends De{constructor(e){super(e),this.type="sunny",this.cloudCover=.5}clone(){return new St({cloudCover:this.cloudCover})}};d([Ie({sunny:"sunny"}),y({json:{write:{isRequired:!0}}})],Ue.prototype,"type",void 0),d([y({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Ue.prototype,"cloudCover",void 0),Ue=St=d([Q("esri.views.3d.environment.SunnyWeather")],Ue);const ft=1e4,ks=1e5;class Ys{constructor(){this.startTime=0,this._data=ht(null),this._readChannels=et.RG,this.parallax=new or,this.parallaxNew=new or,this._anchorPoint=Pe(),this._fadeState=ht(f.HIDE),this._fadeFactor=ht(1)}get data(){return this._data.value}set data(t){this._data.value=t}get readChannels(){return this._readChannels}get fadeState(){return this._fadeState.value}get fadeFactor(){return this._fadeFactor.value}get opacity(){switch(this.fadeState){case f.HIDE:return 0;case f.FADE_OUT:return 1-this.fadeFactor;case f.FADE_IN:return this.fadeFactor;case f.SHOW:case f.CROSS_FADE:return 1}}fade(t,r,i){this.isFading&&this.fadeFactor<1&&(this._fadeFactor.value=i?$r((r-this.startTime)/(Qs*i),0,1):1,this.fadeFactor===1&&this._endFade()),this._evaluateState(t,r),this._updateParallax(t)}_evaluateState(t,r){const i=t.relativeElevation,a=this._updateAnchorPoint(t);(i>1.7*ft||i<-1e4||a>hr)&&this.opacity>0?this._startFade(f.HIDE,r):this.isFading||(i>ft||i<-.35*ft||a>Js*hr?this.opacity>0&&this._startFade(f.FADE_OUT,r):Bs(this.data)&&(this.opacity===0?this._startFade(f.FADE_IN,r):this.data.state===B.Ready&&(this.fadeState===f.SHOW?this._startFade(f.CROSS_FADE,r):this._startFade(f.SHOW,r))))}_updateParallax(t){const r=ei(t.eye);this.parallax.radiusCurvatureCorrection=.84*Math.sqrt(Math.max(r-Be.radius*Be.radius,0))/Math.sqrt(r),Kt(lr,this.parallax.anchorPoint,ce),Vt(this.parallax.transform,se,ce[3],Zt(ce)),Kt(lr,this.parallaxNew.anchorPoint,ce),Vt(this.parallaxNew.transform,se,ce[3],Zt(ce))}_updateAnchorPoint(t){var r;return ri(this._anchorPoint,t.eye),ii(this._anchorPoint,this._anchorPoint,Be.radius),this.fadeState===f.HIDE&&((r=this.data)==null?void 0:r.state)===B.Ready?(G(this.parallax.anchorPoint,this._anchorPoint),0):ti(si(Xs,this.parallax.anchorPoint,this._anchorPoint))}requestFade(){this._fadeFactor.value=0}_startFade(t,r){switch(this._fadeState.value=t,this.startTime=r,t){case f.CROSS_FADE:this.requestFade(),this._switchReadChannels(),G(this.parallaxNew.anchorPoint,this._anchorPoint);break;case f.FADE_IN:this.requestFade(),this._switchReadChannels(),G(this.parallax.anchorPoint,this._anchorPoint),G(this.parallaxNew.anchorPoint,this._anchorPoint);break;case f.FADE_OUT:this.requestFade();break;case f.SHOW:this._switchReadChannels(),G(this.parallax.anchorPoint,this._anchorPoint),G(this.parallaxNew.anchorPoint,this._anchorPoint),this._endFade();break;case f.HIDE:this._endFade()}}_endFade(){switch(this._fadeFactor.value=1,this.data&&this.data.state!==B.Ready&&(this.data.state=B.Idle),this.fadeState){case f.CROSS_FADE:G(this.parallax.anchorPoint,this.parallaxNew.anchorPoint),this._fadeState.value=f.SHOW;break;case f.FADE_IN:this._fadeState.value=f.SHOW;break;case f.FADE_OUT:this._fadeState.value=f.HIDE;break;case f.SHOW:case f.HIDE:break;default:ai(this.fadeState)}}_switchReadChannels(){var t;((t=this.data)==null?void 0:t.state)===B.Ready&&(this._readChannels=1-this._readChannels,this.data.state=B.Fading)}get isFading(){return this.fadeState===f.FADE_OUT||this.fadeState===f.FADE_IN||this.fadeState===f.CROSS_FADE}}var f;(function(e){e[e.HIDE=0]="HIDE",e[e.FADE_IN=1]="FADE_IN",e[e.SHOW=2]="SHOW",e[e.CROSS_FADE=3]="CROSS_FADE",e[e.FADE_OUT=4]="FADE_OUT"})(f||(f={}));let or=class{constructor(){this.anchorPoint=Pe(),this.radiusCurvatureCorrection=0,this.transform=N()}};const lr=Dt(0,0,1),ce=Vs(),Xs=Pe(),Qs=1.25,Js=.5,hr=2e5;let Ks=class extends Vr{constructor(t,r){super(t,"samplerCube",qr.Bind,(i,a)=>i.bindTexture(t,r(a)))}};function Nn(e){const t=e.fragment;t.constants.add("radiusCloudsSquared","float",Zs).code.add(w`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos) {
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusCloudsSquared;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
return (cameraPosition + dir * pointIntDist) - spherePos;
}`),t.uniforms.add(new dt("radiusCurvatureCorrection",({clouds:l})=>l.parallax.radiusCurvatureCorrection)).code.add(w`vec3 correctForPlanetCurvature(vec3 dir) {
dir.z = dir.z * (1.0 - radiusCurvatureCorrection) + radiusCurvatureCorrection;
return dir;
}`),t.code.add(w`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec) {
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),zi(t),qi(t);const r=Dt(.28,.175,.035);t.constants.add("RIM_COLOR","vec3",r),t.code.add(w`
    vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds) {
      float upDotLight = dot(cameraPosition, mainLightDirection);
      float dirDotLight = max(dot(worldSpaceRay, mainLightDirection), 0.0);
      float sunsetTransition = clamp(pow(max(upDotLight, 0.0), ${w.float(.3)}), 0.0, 1.0);

      // Base color of the clouds that depends on lighting of the sun and sky
      vec3 ambientLight = calculateAmbientIrradiance(cameraPosition,  0.0);
      vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
      vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));

      // Rim light around the edge of the clouds simulating scattering of the direct lun light
      float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
      float rimLightIntensity = 0.5 + 0.5 * pow(max(upDotLight, 0.0), 0.35);
      vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, ${w.float(140)})) * scatteringMod;

      // Brighten the clouds around the sun at the sunsets
      float additionalLight = ${w.float(.2)} * pow(dirDotLight, ${w.float(10)}) * (1. - pow(sunsetTransition, ${w.float(.3)})) ;

      return vec3(baseCloudColor * (1.0 + additionalLight) + directSunScattering);
    }
  `),t.uniforms.add(new Yt("readChannelsRG",l=>l.clouds.readChannels===et.RG),new Ks("cubeMap",l=>{var c,u;return((u=(c=l.clouds.data)==null?void 0:c.cubeMap)==null?void 0:u.colorTexture)??null})).code.add(w`vec4 sampleCloud(vec3 rayDir, bool readOtherChannel) {
vec4 s = texture(cubeMap, rayDir);
bool readRG = readChannelsRG ^^ readOtherChannel;
s = readRG ? vec4(vec3(s.r), s.g) : vec4(vec3(s.b), s.a);
return length(s) == 0.0 ? vec4(s.rgb, 1.0) : s;
}`),t.uniforms.add(new Xt("anchorPoint",l=>l.clouds.parallax.anchorPoint),new Xt("anchorPointNew",l=>l.clouds.parallaxNew.anchorPoint),new Qt("rotationClouds",l=>l.clouds.parallax.transform),new Qt("rotationCloudsNew",l=>l.clouds.parallaxNew.transform),new dt("cloudsOpacity",l=>l.clouds.opacity),new dt("fadeFactor",l=>l.clouds.fadeFactor),new Yt("crossFade",l=>l.clouds.fadeState===f.CROSS_FADE)).code.add(w`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition) {
vec3 intersectionPoint = intersectWithCloudLayer(worldRay, cameraPosition, anchorPoint);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = sampleCloud(worldRayRotatedCorrected, crossFade);
vec3 cameraPositionN = normalize(cameraPosition);
vec4 cloudColor = vec4(calculateCloudColor(cameraPositionN, worldRay, cloudData), cloudData.a);
if(crossFade) {
intersectionPoint = intersectWithCloudLayer(worldRay, cameraPosition, anchorPointNew);
worldRayRotated = rotateDirectionToAnchorPoint(rotationCloudsNew, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = sampleCloud(worldRayRotatedCorrected, false);
vec4 cloudColorNew = vec4(calculateCloudColor(cameraPositionN, worldRay, cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorNew, fadeFactor);
}
float totalTransmittance = length(cloudColor.rgb) == 0.0 ?
1.0 :
clamp(cloudColor.a * cloudsOpacity + (1.0 - cloudsOpacity), 0.0 , 1.0);
return vec4(cloudColor.rgb, totalTransmittance);
}`)}const Zs=(Be.radius+ks)**2;var ve;(function(e){e[e.Disabled=0]="Disabled",e[e.Enabled=1]="Enabled",e[e.EnabledWithWater=2]="EnabledWithWater",e[e.COUNT=3]="COUNT"})(ve||(ve={}));let jr=class extends Fe{constructor(){super(...arguments),this.color=Dt(1,1,1)}};function ea(){const e=new ee;return e.include(At),e.fragment.uniforms.add(new U("tex",t=>t.texture),new ji("uColor",t=>t.color)),e.fragment.main.add(w`vec4 texColor = texture(tex, uv);
fragColor = texColor * vec4(uColor, 1.0);`),e}const ta=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:jr,build:ea},Symbol.toStringTag,{value:"Module"}));let cr=class extends Vr{constructor(t,r){super(t,"ivec2",qr.Pass,(i,a,s)=>i.setUniform2iv(t,r(a,s)))}};class Gr extends Fe{}function ra(){const e=new ee,{outputs:t,fragment:r}=e;return e.include(At),r.uniforms.add(new Wr("textureInput",i=>i.input)),r.constants.add("outlineWidth","int",Math.ceil(tt)),r.constants.add("cellSize","int",ae),t.add("fragGrid","vec2"),r.main.add(w`ivec2 inputTextureSize = textureSize(textureInput, 0);
ivec2 cellBottomLeftCornerInput = ivec2(floor(gl_FragCoord.xy) * vec2(cellSize));
ivec2 coordMid =  cellBottomLeftCornerInput + ivec2(cellSize >> 1);
uvec2 centreTexel = uvec2( texelFetch(textureInput, coordMid, 0).rg * 255.0) & uvec2(0x55u);
float marginSquare = float(outlineWidth*outlineWidth);
uvec2 outputValue = centreTexel & uvec2(0x55u);
for(int y = -outlineWidth; y <= cellSize + outlineWidth; y+=2) {
int dy = y < 0 ? -y : y > cellSize ? y-cellSize : 0;
int xMargin = dy > 0 ? int(ceil(sqrt(marginSquare - float(dy*dy)))) : outlineWidth;
for(int x = -xMargin; x <= cellSize + xMargin; x+=2) {
ivec2 coord = cellBottomLeftCornerInput + ivec2(x, y);
uvec2[4] texels = uvec2[4] (
uvec2(texelFetch(textureInput,coord+ivec2(0,0),0).rg * 255.0) & uvec2(0x55u),
uvec2(texelFetch(textureInput,coord+ivec2(1,0),0).rg * 255.0) & uvec2(0x55u),
uvec2(texelFetch(textureInput,coord+ivec2(0,1),0).rg * 255.0) & uvec2(0x55u),
uvec2(texelFetch(textureInput,coord+ivec2(1,1),0).rg * 255.0) & uvec2(0x55u)
);
if (texels[0] == texels[1] && texels[1] == texels[2] && texels[2] == texels[3] && texels[3] ==  centreTexel) {
continue;
}
for (int i=0; i<4; ++i){
outputValue |= ((texels[i] ^ centreTexel) << 1);
outputValue |= texels[i];
}
}
}
fragGrid = vec2(outputValue) / 255.0;`),e}const ae=32,tt=9,Br=.4,ia=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:Gr,blurSize:Br,build:ra,gridCellPixelSize:ae,outlineSize:tt},Symbol.toStringTag,{value:"Module"}));function at(e){const{vertex:t}=e;t.uniforms.add(new U("coverageTexture",r=>r.coverageTexture),new cr("highlightRenderCellCount",r=>H(ur,r.horizontalCellCount,r.verticalCellCount)),new cr("highlightTextureResolution",({highlightTexture:r})=>H(ur,r.descriptor.width,r.descriptor.height)),new it("highlightLevel",r=>r.highlightLevel)).constants.add("cellSize","int",ae),e.varyings.add("sUV","vec2"),e.varyings.add("vOutlinePossible","float"),t.code.add(w`const ivec2 cellVertices[4] = ivec2[4](ivec2(0,0), ivec2(1,0), ivec2(0,1), ivec2(1,1));`).main.add(w`int cellIndex = gl_InstanceID;
int cellX = cellIndex % highlightRenderCellCount[0];
int cellY = (cellIndex - cellX) / highlightRenderCellCount[0];
ivec2 cellPos = ivec2(cellX, cellY);
uvec2 covTexel = uvec2(texelFetch(coverageTexture, cellPos, 0).rg * 255.0);
int channelIndex = (highlightLevel >> 2) & 3;
uint channelValue = covTexel[channelIndex];
int highlightIndex = (highlightLevel & 3) << 1;
bool covered = ((channelValue >> highlightIndex) & 1u) == 1u;
if (!covered) {
gl_Position = vec4(0.0);
return;
}
vOutlinePossible = (((channelValue >> highlightIndex) & 2u) == 2u) ? 1.0 : 0.0;
ivec2 iPosInCell = cellVertices[gl_VertexID];
vec2 sPos = vec2(cellPos * cellSize + iPosInCell * (cellSize));
vec2 vPos = sPos / vec2(highlightTextureResolution);
sUV = vPos;
gl_Position = vec4(2.0 * vPos - vec2(1.0), 0.0, 1.0);`)}const ur=v();function sa(){const e=new ee;e.include(at);const{fragment:t}=e;return t.uniforms.add(new U("highlightTexture",r=>r.highlightTexture),new U("highlightOptionsTexture",r=>r.highlightOptionsTexture),new Je("pixelRatio",r=>r.pixelRatio),new Je("occludedIntensityFactor",r=>r.occludedFactor),new Gi("maxHighlightLevel",r=>r.highlights.length-1)),t.constants.add("pixelSampleScale","float",1),e.include(Ft),t.code.add(w`const float pascal17[9] = float[9](12870.0, 11440.0, 8008.0, 4368.0, 1820.0, 560.0, 120.0, 16.0, 1.0);
const float denom17 =  65536.0;
float colorWeight[16] = float[16](0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);
float colorOcclusion[16] = float[16](0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);
float weights[16] = float[16](0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);
void applyTexel(vec2 texel, float weight) {
if (texel != vec2(0.0)){
int maxChannel = (maxHighlightLevel >> 2) & 1;
for (int channelIndex = 0; channelIndex <= maxChannel; ++channelIndex){
uint channel = readChannel(texel, channelIndex << 2);
int firstIndex = channelIndex << 2;
int maxIndex  = min(firstIndex + 3, maxHighlightLevel);
for (int highlightIndex = firstIndex; highlightIndex <= maxIndex; ++highlightIndex ) {
uint v = readChannelBits(channel, highlightIndex);
if ((v & 1u) == 1u){
colorWeight[highlightIndex] += weight;
if ((v & 2u) == 2u){
colorOcclusion[highlightIndex] += weight;
}
}
}
}
}
}
vec2 readTexel(ivec2 iuv, int du, int dv) {
return texelFetch(highlightTexture, iuv + ivec2(du, dv), 0).rg;
}
void readAndApplyTexel(ivec2 iuv, int du, int dv, float weight) {
vec2 texel = readTexel(iuv, du, dv);
applyTexel(texel, weight);
}
void readAndApply2TexelsU(ivec2 iuv, int du, int dv, float weight) {
readAndApplyTexel(iuv, -du, dv, weight);
readAndApplyTexel(iuv, +du, dv, weight);
}
float getWeight(int pixelDistance) {
float scaledDistance = float(pixelDistance) * pixelSampleScale / pixelRatio;
float d0f = floor(scaledDistance);
int d0 = int(d0f);
if (d0 >= 8){
return 0.0;
}
float w0 = pascal17[d0];
float w1 = pascal17[d0+1];
float f =  scaledDistance - d0f;
return mix(w0, w1, f);
}`),t.main.add(w`vec2 highlightTextureSize = vec2(textureSize(highlightTexture,0));
ivec2 iuv = ivec2(sUV * highlightTextureSize);
vec2 centerTexel = texelFetch(highlightTexture, iuv, 0).rg;
bool outlinePossible = false;
if (vOutlinePossible > 0.0){
for (int highlightLevel=0; highlightLevel<= maxHighlightLevel; ++highlightLevel) {
if ((readLevelBits(centerTexel,highlightLevel) & 1u) == 0u) {
outlinePossible = true;
break;
}
}
}
if (outlinePossible) {
int maxPixelDistance = clamp(int(8.0 * pixelRatio / pixelSampleScale), 2, 16);
float weightSum = 0.0;
for(int y = 0; y <= maxPixelDistance; ++y) {
float w = getWeight(y);
weights[y] = w;
weightSum += w * (y == 0 ? 1.0 : 2.0);
}
for(int y = 0; y <= maxPixelDistance; ++y) {
weights[y] = weights[y] / weightSum;
}
float weight0 = weights[0];
applyTexel(centerTexel, weight0 * weight0);
for(int y = 0; y <= maxPixelDistance; y += 1) {
float yFactor = weights[y];
if (y != 0) {
float xFactor = weight0;
float weight = xFactor * yFactor;
if (weight > 0.0) {
readAndApplyTexel(iuv, 0, +y, weight);
readAndApplyTexel(iuv, 0, -y, weight);
}
}
for(int x = 1; x <= maxPixelDistance; x += 1) {
float xFactor = weights[x];
float weight = xFactor * yFactor;
if (weight > 0.0) {
readAndApply2TexelsU(iuv, x, +y, weight);
if (y != 0){
readAndApply2TexelsU(iuv, x, -y, weight);
}
}
}
}
} else {
applyTexel(centerTexel, 1.0);
}
int frontColorIndex = 999;
int maxColorIndex = 0;
for (int i = 0; i <= maxHighlightLevel; ++i) {
if (colorWeight[i] > 0.0){
frontColorIndex = min(frontColorIndex, i);
maxColorIndex = max(maxColorIndex, i);
}
}
if (frontColorIndex == 999){
fragColor = vec4(0.0);
return;
}
vec4 accumulatedColor = vec4(0.0);
for (int curColorIndex = frontColorIndex; curColorIndex <= maxColorIndex; ++curColorIndex) {
float curColorWeight = colorWeight[curColorIndex];
if (curColorWeight <= 0.01){
continue;
}
uint vc = readLevelBits(centerTexel, curColorIndex);
bool centerFilled = (vc & 1u) == 1u;
bool centerOccluded = (vc & 3u) == 3u;
float curColorOcclusion = colorOcclusion[curColorIndex];
bool occluded = centerFilled ? centerOccluded : curColorOcclusion > 0.5 * curColorWeight;
int colorChannel = centerFilled ? 0 : 1;
vec4 colorBase = texelFetch(highlightOptionsTexture, ivec2(curColorIndex, colorChannel), 0);
float occlusionFactor = occluded ? occludedIntensityFactor : 1.0;
float outlineFactor = centerFilled ? 1.0 : smoothstep(0.0, 0.03, curColorWeight);
float intensity = colorBase.a * occlusionFactor * outlineFactor;
vec3 currentColor = colorBase.rgb;
float a0 = accumulatedColor.a;
float a1 = intensity;
float alpha = clamp(a0 + a1 - a0 * a1, 0.0, 1.0);
if (alpha > 0.001){
vec3 blendedColor = ((1.0 - a1) * a0 * accumulatedColor.rgb + a1 * currentColor) / alpha;
accumulatedColor = vec4(blendedColor, alpha);
}
}
fragColor = accumulatedColor;`),e}const aa=Object.freeze(Object.defineProperty({__proto__:null,build:sa},Symbol.toStringTag,{value:"Module"}));let dr=class extends K{constructor(t,r){super(t,r,new Z(aa,()=>J(()=>import("./ImageMaterial.glsl-COuETN4q.js").then(i=>i.H),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76]))))}initializePipeline(){return Y({blending:Mt,colorWrite:X})}},gr=class extends K{constructor(t,r){super(t,r,new Z(ia,()=>J(()=>import("./ImageMaterial.glsl-COuETN4q.js").then(i=>i.a),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76]))))}initializePipeline(){return Y({colorWrite:X})}},na=class extends Fe{constructor(){super(...arguments),this.occludedFactor=ni,this.verticalCellCount=0,this.horizontalCellCount=0,this.highlightLevel=0,this.pixelRatio=1}};function oa(){const e=new ee;e.include(at),e.include(Ft);const{fragment:t}=e;return e.outputs.add("fragSingleHighlight","vec2",0),t.uniforms.add(new U("highlightTexture",r=>r.highlightTexture),new it("highlightLevel",r=>r.highlightLevel)),t.main.add(w`ivec2 iuv = ivec2(gl_FragCoord.xy);
vec2 inputTexel = texelFetch(highlightTexture, iuv, 0).rg;
uint bits = readLevelBits(inputTexel, highlightLevel);
bool hasHighlight = (bits & 1u) == 1u;
bool hasOccluded  = (bits & 2u) == 2u;
fragSingleHighlight = vec2(hasHighlight ? 1.0 : 0.0, hasOccluded ? 1.0 : 0.0);`),e}const la=Object.freeze(Object.defineProperty({__proto__:null,build:oa},Symbol.toStringTag,{value:"Module"}));let pr=class extends K{constructor(t,r){super(t,r,new Z(la,()=>J(()=>import("./ImageMaterial.glsl-COuETN4q.js").then(i=>i.b),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76]))))}initializePipeline(){return Y({colorWrite:X})}};function ha(){const e=new ee;e.include(at);const{fragment:t}=e;return t.uniforms.add(new U("blurInput",r=>r.singleHighlightBlurTexture),new Ur("blurSize",r=>r.blurSize),new U("highlightTexture",r=>r.highlightTexture),new U("highlightOptionsTexture",r=>r.highlightOptionsTexture),new it("highlightLevel",r=>r.highlightLevel),new Je("occludedIntensityFactor",r=>r.occludedFactor)),t.constants.add("inner","float",1-(tt-Br)/tt),e.include(Ft),t.main.add(w`vec2 highlightTextureSize = vec2(textureSize(highlightTexture,0));
vec2 uv = sUV;
vec2 center = texture(blurInput, uv).rg;
vec2 blurredHighlightValue = (vOutlinePossible == 0.0)
? center
: center * 0.204164
+ texture(blurInput, uv + blurSize * 1.407333).rg * 0.304005
+ texture(blurInput, uv - blurSize * 1.407333).rg * 0.304005
+ texture(blurInput, uv + blurSize * 3.294215).rg * 0.093913
+ texture(blurInput, uv - blurSize * 3.294215).rg * 0.093913;
float highlightIntensity = blurredHighlightValue.r;
float occlusionWeight = blurredHighlightValue.g;
if (highlightIntensity <= 0.01) {
discard;
}
vec4 fillColor    = texelFetch(highlightOptionsTexture, ivec2(highlightLevel, 0), 0);
vec4 outlineColor = texelFetch(highlightOptionsTexture, ivec2(highlightLevel, 1), 0);
vec2 centerTexel = texelFetch(highlightTexture, ivec2(uv * highlightTextureSize), 0).rg;
uint centerBits = readLevelBits(centerTexel, highlightLevel);
bool centerFilled = (centerBits & 1u) == 1u;
bool centerOccluded = (centerBits & 3u) == 3u;
bool occluded = centerOccluded || (0.5 * highlightIntensity < occlusionWeight);
float occlusionFactor = occluded ? occludedIntensityFactor : 1.0;
float outlineFactor = centerFilled ? 1.0 : smoothstep(0.0, inner, highlightIntensity);
float fillFactor = centerFilled ? 1.0 : 0.0;
vec4 baseColor = mix(outlineColor, fillColor, fillFactor);
float intensity = baseColor.a * occlusionFactor * outlineFactor;
fragColor = vec4(baseColor.rgb, intensity);`),e}const ca=Object.freeze(Object.defineProperty({__proto__:null,build:ha},Symbol.toStringTag,{value:"Module"}));let _r=class extends K{constructor(t,r){super(t,r,new Z(ca,()=>J(()=>import("./ImageMaterial.glsl-COuETN4q.js").then(i=>i.S),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76]))))}initializePipeline(){return Y({blending:Mt,colorWrite:X})}},kr=class extends Fe{constructor(){super(...arguments),this.blurSize=v()}};function ua(){const e=new ee;return e.include(at),e.outputs.add("fragSingleHighlight","vec2",0),e.fragment.uniforms.add(new Ur("blurSize",t=>t.blurSize),new Wr("blurInput",t=>t.blurInput)).main.add(w`vec2 highlightTextureSize = vec2(textureSize(blurInput,0));
vec2 center = texture(blurInput, sUV).rg;
if (vOutlinePossible == 0.0) {
fragSingleHighlight = center;
} else {
vec2 sum = center * 0.204164;
sum += texture(blurInput, sUV + blurSize * 1.407333).rg * 0.304005;
sum += texture(blurInput, sUV - blurSize * 1.407333).rg * 0.304005;
sum += texture(blurInput, sUV + blurSize * 3.294215).rg * 0.093913;
sum += texture(blurInput, sUV - blurSize * 3.294215).rg * 0.093913;
fragSingleHighlight = sum;
}`),e}const da=Object.freeze(Object.defineProperty({__proto__:null,SingleHighlightBlurDrawParameters:kr,build:ua},Symbol.toStringTag,{value:"Module"}));let fr=class extends K{constructor(t,r){super(t,r,new Z(da,()=>J(()=>import("./ImageMaterial.glsl-COuETN4q.js").then(i=>i.c),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76]))))}initializePipeline(){return Y({colorWrite:X})}};const ga=[],kn=[new Xe(x.POSITION,3,$e.FLOAT,0,12)];new Xe(x.POSITION,2,$e.FLOAT,0,8);new Xe(x.POSITION,2,$e.FLOAT,0,16),new Xe(x.UV0,2,$e.FLOAT,8,16);let ze=class extends Bi{constructor(){super(...arguments),this.produces=gt.HIGHLIGHTS,this.consumes={required:[gt.HIGHLIGHTS,"highlights"]},this._useMultipleHighlights=!1,this._downsampleDrawParameters=new Gr,this._passParameters=new na,this._singleHighlightBlurDrawParameters=new kr,this._grid=new pa}initialize(){this.addHandles([pe(()=>this._updateOptionsTexture(),()=>{},wt)])}destroy(){this._grid.coverage=Se(this._grid.coverage),this._grid.vao=Qe(this._grid.vao),this._passParameters.highlightOptionsTexture=Se(this._passParameters.highlightOptionsTexture)}_updateOptionsTexture(){if(this._passParameters.highlightOptionsTexture==null){const t=new Ir(16,2);t.internalFormat=oi.RGBA,t.samplingMode=Dr.NEAREST,this._passParameters.highlightOptionsTexture=new xe(this.renderingContext,t,null)}this._passParameters.highlightOptionsTexture.setData(_a(this.view.state.highlights)),this.requestRender(Oe.UPDATE)}precompile(){this.techniques.precompile(gr),this._useMultipleHighlights?this.techniques.precompile(dr):(this.techniques.precompile(pr),this.techniques.precompile(fr),this.techniques.precompile(_r))}render(t){const r=t.find(({name:g})=>g===gt.HIGHLIGHTS),{techniques:i,bindParameters:a,_passParameters:s,renderingContext:n}=this;if(!a.decorations)return r;const o=i.get(gr);if(!o.compiled)return this.requestRender(Oe.UPDATE),r;const l=t.find(({name:g})=>g==="highlights").getTexture(),c=()=>{var q;this._gridUpdateResources(l);const g=this._gridComputeCoverage(o,l,a),{horizontalCellCount:R,verticalCellCount:z}=g;return s.horizontalCellCount=R,s.verticalCellCount=z,s.coverageTexture=(q=g.coverage)==null?void 0:q.getTexture(),g},u=g=>{const R=g.verticalCellCount*g.horizontalCellCount;n.bindVAO(g.vao),n.drawElementsInstanced(li.TRIANGLES,6,$e.UNSIGNED_BYTE,0,R)},{camera:_}=a,T=()=>{n.bindFramebuffer(r.fbo),n.setViewport4fv(_.fullViewport)};return this._useMultipleHighlights?this._renderMultiple(l,c,u,T):this._renderSingle(l,c,u,T),s.highlightTexture=null,s.coverageTexture=null,r}_renderMultiple(t,r,i,a){const{techniques:s,bindParameters:n,_passParameters:o,renderingContext:l}=this,c=s.get(dr);if(!c.compiled)return void this.requestRender(Oe.UPDATE);const u=r();o.highlightTexture=t,o.pixelRatio=n.camera.pixelRatio,l.bindTechnique(c,n,o),a(),i(u)}_renderSingle(t,r,i,a){var Nt;const{fboCache:s,techniques:n,bindParameters:o,_passParameters:l,renderingContext:c}=this,u=n.get(pr),_=n.get(fr),T=n.get(_r);if(!T.compiled||!_.compiled||!u.compiled)return void this.requestRender(Oe.UPDATE);const g=r(),{width:R,height:z}=t.descriptor;l.highlightTexture=t;const{camera:q}=o,{fullWidth:nt,fullHeight:ot,pixelRatio:Ee}=q,ye=Math.ceil(nt/Ee),m=Math.ceil(ot/Ee),{_singleHighlightBlurDrawParameters:O}=this,Jr=this.view._stage.renderView.renderer,{highlights:Lt}=o;for(let Me=0;Me<Lt.length;++Me){const{name:Kr}=Lt[Me];if(!Jr.hasHighlightOptions(Kr))continue;l.highlightLevel=Me,c.setClearColor(0,0,0,0);const lt=s.acquire(R,z,"single highlight",W.RG);c.bindFramebuffer(lt.fbo),c.setViewport(0,0,R,z),c.clear(ne.COLOR),c.bindTechnique(u,o,l),i(g),O.blurInput=lt.getTexture(),H(O.blurSize,1/ye,0);const Le=s.acquire(ye,m,"single highlight blur h",W.RG);c.unbindTexture((Nt=Le.fbo)==null?void 0:Nt.colorTexture),c.bindFramebuffer(Le.fbo),c.setViewport(0,0,ye,m),c.clear(ne.COLOR),c.bindTechnique(_,o,l,O),i(g),lt.release(),H(O.blurSize,0,1/m),l.singleHighlightBlurTexture=Le.getTexture(),a(),c.bindTechnique(T,o,l,O),i(g),Le.release()}}_gridUpdateResources(t){const r=this._grid,{width:i,height:a}=t.descriptor;if(r.horizontalCellCount=Math.ceil(i/ae),r.verticalCellCount=Math.ceil(a/ae),r.vao)return;const s=this.renderingContext,n=er.createIndex(s,Wt.STATIC_DRAW,va);r.vao=new Ns(s,ki,new Map([["geometry",ga]]),new Map([["geometry",er.createVertex(s,Wt.STATIC_DRAW)]]),n)}_gridComputeCoverage(t,r,i){var u;const a=this.renderingContext,s=this._grid,n=r.descriptor,o=Math.ceil(n.width/ae),l=Math.ceil(n.height/ae);this._downsampleDrawParameters.input=r,(u=s.coverage)==null||u.release();const c=this.fboCache.acquire(o,l,"highlight coverage",W.RG);return s.coverage=c,a.bindFramebuffer(c.fbo),a.bindTechnique(t,i,this._passParameters,this._downsampleDrawParameters),a.setViewport(0,0,o,l),a.screen.draw(),s}get test(){}};d([y()],ze.prototype,"produces",void 0),d([y()],ze.prototype,"consumes",void 0),ze=d([Q("esri.views.3d.webgl-engine.effects.highlight.Highlight")],ze);class pa{constructor(){this.coverage=null,this.vao=null,this.verticalCellCount=0,this.horizontalCellCount=0,this.viewportWidth=0,this.viewportHeight=0}}function _a(e){const t=new Uint8Array(128);let r=0;for(const i of e){const a=4*r,s=4*r+64;++r;const{color:n}=i,o=i.haloColor??n;t[a+0]=n.r,t[a+1]=n.g,t[a+2]=n.b,t[a+3]=i.fillOpacity*n.a*255,t[s+0]=o.r,t[s+1]=o.g,t[s+2]=o.b,t[s+3]=i.haloOpacity*o.a*255}return t}let fa=0;function ma(e){let t=0;for(const i of e){const{name:a}=i;t+=a.length;const{color:s,fillOpacity:n,haloColor:o,haloOpacity:l}=i;t+=s.r+s.g+s.b+s.a+n,t+=o?o.r+o.g+o.b+o.a+l:0}const r=e.at(0);if(r){const{shadowOpacity:i,shadowDifference:a,shadowColor:s}=r;t+=i+a+s.r+s.g+s.b+s.a}return fa+++(t>=0?0:1)}const va=new Uint8Array([0,1,2,2,1,3]);function xa(e,t,r,i,a,s=0){const n=i.highlights,o=n.length>1?t.acquire(r.width,r.height,"highlight mix",W.RG):null;if(o){const c=e.getBoundFramebufferObject();e.bindFramebuffer(o.fbo),e.clearFramebuffer(Pr),e.bindFramebuffer(c)}const l=o==null?void 0:o.getTexture();i.highlightMixTexture=l,H(i.highlightMixOrigin,s,0),n.forEach((c,u)=>{u>0&&(e.bindTexture(l,xe.TEXTURE_UNIT_FOR_UPDATES),e.gl.copyTexSubImage2D(Ar.TEXTURE_2D,0,0,0,s,0,r.width,r.height),e.bindTexture(null,xe.TEXTURE_UNIT_FOR_UPDATES)),e.clear(ne.DEPTH),i.highlightLevel=u,a()}),i.highlightLevel=null,i.highlightMixTexture=null,o==null||o.release()}let ya=class{constructor(t,r,i,a){this._textures=t,this._techniques=r,this.materialChanged=i,this.requestRender=a,this._id2glMaterialRef=new Ws}dispose(){this._textures.destroy()}acquire(t,r,i){this._ownMaterial(t);const a=t.produces.get(r);if(!(a!=null&&a(i)))return null;let s=this._id2glMaterialRef.get(i,t.id);if(s==null){const n=t.createGLMaterial({material:t,techniques:this._techniques,textures:this._textures,output:i});s=new wa(n),this._id2glMaterialRef.set(i,t.id,s)}return s.ref(),s.glMaterial}release(t,r){const i=this._id2glMaterialRef.get(r,t.id);i!=null&&(i.unref(),i.referenced||(Qe(i.glMaterial),this._id2glMaterialRef.delete(r,t.id)))}_ownMaterial(t){t.repository&&t.repository!==this&&hi.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),t.repository=this}},wa=class{constructor(t){this.glMaterial=t,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,me(this._refCnt>=0)}get referenced(){return this._refCnt>0}};var rt;(function(e){e[e.Immediate=0]="Immediate",e[e.FadeWithWeather=1]="FadeWithWeather"})(rt||(rt={}));let Ca=class{constructor(t){this.shadowMap=t,this.slot=E.OPAQUE_MATERIAL,this.slicePlane=null,this.hasOccludees=!1,this.enableFillLights=!0,this.oitPass=Ke.NONE,this.alignPixelEnabled=!1,this.decorations=!0,this.overlayStretch=1,this.viewshedEnabled=!1,this._camera=new st,this._inverseViewport=v(),this._oldLighting=new pt,this._newLighting=new pt,this._fadedLighting=new pt,this._lighting=this._newLighting,this.ssr=new ba,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.highlights=new Array,this.highlightOrderMap=new Map,this.highlightMixOrigin=v(),this.highlightMixTexture=null,this.hudRenderStyle=Us.Occluded,this.hudOccludedFragmentOpacity=1,this.clouds=new Ys,this.shadowHighlightsVisible=!1}get camera(){return this._camera}set camera(t){this._camera=t,this._inverseViewport[0]=1/t.fullViewport[2],this._inverseViewport[1]=1/t.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}fadeLighting(){switch(this.clouds.fadeFactor){case 0:this._lighting=this._oldLighting;break;default:this._fadedLighting.lerpLighting(this._oldLighting,this._newLighting,this.clouds.fadeFactor),this._lighting=this._fadedLighting;break;case 1:this._lighting=this._newLighting,this._oldLighting.copyFrom(this._newLighting)}}updateLighting(t,r,i,a){this._oldLighting.copyFrom(this.lighting),this._newLighting.noonFactor=r,this._newLighting.globalFactor=i,this._newLighting.set(t),a===rt.FadeWithWeather&&this.clouds.requestFade(),this.fadeLighting()}get highlight(){return this.highlightLevel==null?null:this.highlights[this.highlightLevel]}},ba=class{constructor(){this.fadeFactor=1,this.reprojectionMatrix=N()}},Ta=class{constructor(t,r){this.rctx=t,this.lastFrameCamera=new st,this.output=D.Color,this.renderOccludedMask=Ye,this.bind=new Ca(r),this.bind.alignPixelEnabled=!0}};const Ye=ke.Occlude|ke.OccludeAndTransparent|ke.OccludeAndTransparentStencil;let Re=class extends st{constructor(){super(...arguments),this._projectionMatrix=N()}get projectionMatrix(){return this._projectionMatrix}};d([y()],Re.prototype,"_projectionMatrix",void 0),d([y({readOnly:!0})],Re.prototype,"projectionMatrix",null),Re=d([Q("esri.views.3d.webgl-engine.lib.CascadeCamera")],Re);var $t;(function(e){e[e.Highlight=0]="Highlight",e[e.ExcludeHighlight=1]="ExcludeHighlight"})($t||($t={}));class qe{constructor(){this.camera=new Re,this.lightMat=N()}}class Oa{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}}class Ra{constructor(t,r){this._fbos=t,this._viewingMode=r,this._enabled=!1,this._snapshots=new Array,this._textureHeight=0,this._numCascades=1,this.settings=new Oa,this._projectionView=N(),this._projectionViewInverse=N(),this._modelViewLight=N(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=Pt(),this._cascades=[new qe,new qe,new qe,new qe],this._lastOrigin=null,this._maxTextureWidth=Math.min(ci("esri-mobile")?4096:16384,t.rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}get depthTexture(){var t;return(t=this._handle)==null?void 0:t.getTexture()}get _textureWidth(){return this._textureHeight*this._numCascades}get numCascades(){return this._numCascades}get cascadeDistances(){return Ut(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}disposeOffscreenBuffers(){this._handle=Se(this._handle),this._discardSnapshots()}set maxCascades(t){this.settings.maxNumCascadesHighQuality=$r(Math.floor(t),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(t){this._enabled=t,t||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&this.depthTexture!=null}get cascades(){for(let t=0;t<this._numCascades;++t)vt[t]=this._cascades[t];return vt.length=this._numCascades,vt}start(t,r,i,a,s){me(this.enabled);const{near:n,far:o}=Aa(i);this._computeCascadeDistances(n,o,a),this._textureHeight=this._computeTextureHeight(t,s,a),this._setupMatrices(t,r);const{viewMatrix:l,projectionMatrix:c}=t;for(let u=0;u<this._numCascades;++u)this._constructCascade(u,c,l,r);this._lastOrigin=null,this.clear()}finish(){var t;me(this.enabled),(t=this._handle)==null||t.detachDepth()}getShadowMapMatrices(t){if(!this._lastOrigin||!ui(t,this._lastOrigin)){this._lastOrigin=this._lastOrigin||Pe(),G(this._lastOrigin,t);for(let r=0;r<this._numCascades;++r){zt(Cr,this._cascades[r].lightMat,t);for(let i=0;i<16;++i)br[16*r+i]=Cr[i]}}return br}moveSnapshot(t){var r,i;me(this.enabled),(r=this._handle)==null||r.detachDepth(),(i=this._snapshots[t])==null||i.release(),this._snapshots[t]=this._handle,this._handle=null,this.clear()}copySnapshot(t){var l,c,u,_;const r=(c=(l=this._handle)==null?void 0:l.getTexture())==null?void 0:c.descriptor;if(!this.enabled||!r)return;(u=this._snapshots[t])==null||u.release();const{width:i,height:a}=r,s=t===$t.Highlight?"shadow highlight snapshot":"shadow no highlight snapshot";this._snapshots[t]=this._fbos.acquire(i,a,s,W.RGBA4);const n=this._fbos.rctx;this._bindFbo();const o=n.bindTexture((_=this._snapshots[t])==null?void 0:_.getTexture(),xe.TEXTURE_UNIT_FOR_UPDATES);n.gl.copyTexSubImage2D(Ar.TEXTURE_2D,0,0,0,0,0,i,a),n.bindTexture(o,xe.TEXTURE_UNIT_FOR_UPDATES)}getSnapshot(t){var r;return this.enabled?(r=this._snapshots[t])==null?void 0:r.getTexture():null}clear(){const t=this._fbos.rctx;this._ensureFbo(),this._bindFbo(),t.setClearColor(1,1,1,1),t.clear(ne.COLOR|ne.DEPTH)}_computeTextureHeight(t,r,i){const a=Math.min(window.devicePixelRatio,r)/t.pixelRatio,s=i?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality,n=Yi(Math.floor(Math.max(t.fullWidth,t.fullHeight)*a*s)),o=Math.min(this._maxTextureWidth,this._numCascades*n);return Xi(o/this._numCascades)}_ensureFbo(){var t,r,i,a,s;((r=(t=this._handle)==null?void 0:t.fbo)==null?void 0:r.width)===this._textureWidth&&((i=this._handle)==null?void 0:i.fbo.height)===this._textureHeight||((a=this._handle)==null||a.release(),this._handle=this._fbos.acquire(this._textureWidth,this._textureHeight,"shadow map",W.RGBA4)),(s=this._handle)==null||s.acquireDepth(Qi.DEPTH16_BUFFER)}_discardSnapshot(t){this._snapshots[t]=Se(this._snapshots[t])}_discardSnapshots(){for(let t=0;t<this._snapshots.length;++t)this._discardSnapshot(t);this._snapshots.length=0}_bindFbo(){var t;this._fbos.rctx.bindFramebuffer((t=this._handle)==null?void 0:t.fbo)}_constructCascade(t,r,i,a){const s=this._cascades[t],n=-this._cascadeDistances[t],o=-this._cascadeDistances[t+1],l=(r[10]*n+r[14])/Math.abs(r[11]*n+r[15]),c=(r[10]*o+r[14])/Math.abs(r[11]*o+r[15]);me(l<c);for(let g=0;g<8;++g){Ut(mr,g%4==0||g%4==3?-1:1,g%4==0||g%4==1?-1:1,g<4?l:c,1);const R=L[g];di(R,mr,this._projectionViewInverse),R[0]/=R[3],R[1]/=R[3],R[2]/=R[3]}gi(mt,L[0]),s.camera.viewMatrix=zt(Sa,this._modelViewLight,mt);for(let g=0;g<8;++g)Fr(L[g],L[g],s.camera.viewMatrix);let u=L[0][2],_=L[0][2];for(let g=1;g<8;++g)u=Math.min(u,L[g][2]),_=Math.max(_,L[g][2]);u-=200,_+=200,s.camera.near=-_,s.camera.far=-u,Pa(i,a,u,_,s.camera),Ct(s.lightMat,s.camera.projectionMatrix,s.camera.viewMatrix);const T=this._textureHeight;s.camera.viewport=[t*T,0,T,T]}_setupMatrices(t,r){Ct(this._projectionView,t.projectionMatrix,t.viewMatrix),pi(this._projectionViewInverse,this._projectionView);const i=this._viewingMode===Er.Global?t.eye:Mr(mt,0,0,1);_i(this._modelViewLight,[0,0,0],[-r[0],-r[1],-r[2]],i)}_computeCascadeDistances(t,r,i){const a=i?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor(Wi(r/t,4)),a);const s=(r-t)/this._numCascades,n=(r/t)**(1/this._numCascades);let o=t,l=t;for(let c=0;c<this._numCascades+1;++c)this._cascadeDistances[c]=fi(o,l,this.settings.splitSchemeLambda),o*=n,l+=s}get test(){}}const Sa=N(),mr=Pt(),L=[];for(let e=0;e<8;++e)L.push(Pt());const vr=v(),xr=v(),$a=v(),yr=v(),wr=v(),mt=Pe(),vt=[],Cr=N(),br=se.concat(se,se,se,se),M=v(),ue=v(),ie=[v(),v(),v(),v()],b=v(),xt=v(),j=v(),Te=v(),de=v(),ge=v(),je=v();function Ia(e,t,r,i,a,s,n,o){H(M,0,0);for(let m=0;m<4;++m)re(M,M,e[m]);_e(M,M,.25),H(ue,0,0);for(let m=4;m<8;++m)re(ue,ue,e[m]);_e(ue,ue,.25),we(ie[0],e[4],e[5],.5),we(ie[1],e[5],e[6],.5),we(ie[2],e[6],e[7],.5),we(ie[3],e[7],e[4],.5);let l=0,c=qt(ie[0],M);for(let m=1;m<4;++m){const O=qt(ie[m],M);O<c&&(c=O,l=m)}fe(b,ie[l],e[l+4]);const u=b[0];let _,T;b[0]=-b[1],b[1]=u,fe(xt,ue,M),$(xt,b)<0&&vi(b,b),we(b,b,xt,r),jt(b,b),_=T=$(fe(j,e[0],M),b);for(let m=1;m<8;++m){const O=$(fe(j,e[m],M),b);O<_?_=O:O>T&&(T=O)}xi(i,M),_e(j,b,_-t),re(i,i,j);let g=-1,R=1,z=0,q=0;for(let m=0;m<8;++m){fe(Te,e[m],i),jt(Te,Te);const O=b[0]*Te[1]-b[1]*Te[0];O>0?O>g&&(g=O,z=m):O<R&&(R=O,q=m)}oe(g>0,"leftArea"),oe(R<0,"rightArea"),_e(de,b,_),re(de,de,M),_e(ge,b,T),re(ge,ge,M),je[0]=-b[1],je[1]=b[0];const nt=Ne(i,e[q],ge,re(j,ge,je),1,a),ot=Ne(i,e[z],ge,j,1,s),Ee=Ne(i,e[z],de,re(j,de,je),1,n),ye=Ne(i,e[q],de,j,1,o);oe(nt,"rayRay"),oe(ot,"rayRay"),oe(Ee,"rayRay"),oe(ye,"rayRay")}function p(e,t){return 3*t+e}const Tr=v();function P(e,t){return H(Tr,e[t],e[t+3]),Tr}const I=v(),h=zs();function Da(e,t,r,i,a){fe(I,r,i),_e(I,I,.5),h[0]=I[0],h[1]=I[1],h[2]=0,h[3]=I[1],h[4]=-I[0],h[5]=0,h[6]=I[0]*I[0]+I[1]*I[1],h[7]=I[0]*I[1]-I[1]*I[0],h[8]=1,h[p(0,2)]=-$(P(h,0),e),h[p(1,2)]=-$(P(h,1),e);let s=$(P(h,0),r)+h[p(0,2)],n=$(P(h,1),r)+h[p(1,2)],o=$(P(h,0),i)+h[p(0,2)],l=$(P(h,1),i)+h[p(1,2)];s=-(s+o)/(n+l),h[p(0,0)]+=h[p(1,0)]*s,h[p(0,1)]+=h[p(1,1)]*s,h[p(0,2)]+=h[p(1,2)]*s,s=1/($(P(h,0),r)+h[p(0,2)]),n=1/($(P(h,1),r)+h[p(1,2)]),h[p(0,0)]*=s,h[p(0,1)]*=s,h[p(0,2)]*=s,h[p(1,0)]*=n,h[p(1,1)]*=n,h[p(1,2)]*=n,h[p(2,0)]=h[p(1,0)],h[p(2,1)]=h[p(1,1)],h[p(2,2)]=h[p(1,2)],h[p(1,2)]+=1,s=$(P(h,1),t)+h[p(1,2)],n=$(P(h,2),t)+h[p(2,2)],o=$(P(h,1),r)+h[p(1,2)],l=$(P(h,2),r)+h[p(2,2)],s=-.5*(s/n+o/l),h[p(1,0)]+=h[p(2,0)]*s,h[p(1,1)]+=h[p(2,1)]*s,h[p(1,2)]+=h[p(2,2)]*s,s=$(P(h,1),t)+h[p(1,2)],n=$(P(h,2),t)+h[p(2,2)],o=-n/s,h[p(1,0)]*=o,h[p(1,1)]*=o,h[p(1,2)]*=o,a[0]=h[0],a[1]=h[1],a[2]=0,a[3]=h[2],a[4]=h[3],a[5]=h[4],a[6]=0,a[7]=h[5],a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=h[6],a[13]=h[7],a[14]=0,a[15]=h[8]}function Pa(e,t,r,i,a){const s=1/L[0][3],n=1/L[4][3];me(s<n);let o=s+Math.sqrt(s*n);const l=Math.sin(mi(e[2]*t[0]+e[6]*t[1]+e[10]*t[2]));o/=l,Ia(L,o,l,vr,xr,$a,yr,wr),Da(vr,xr,yr,wr,a.projectionMatrix),a.projectionMatrix[10]=2/(r-i),a.projectionMatrix[14]=-(r+i)/(r-i)}function Aa(e){let{near:t,far:r}=e;return t<2&&(t=2),r<2&&(r=2),t>=r&&(t=2,r=4),{near:t,far:r}}let Or=class extends K{constructor(t,r){super(t,r,new Z(ta,()=>J(()=>import("./ImageMaterial.glsl-COuETN4q.js").then(i=>i.T),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76]))))}initializePipeline(t){return t.hasAlpha?Y({blending:Mt,colorWrite:X}):Y({colorWrite:X})}},Yr=class extends Ji{constructor(){super(...arguments),this.hasAlpha=!1}};d([A()],Yr.prototype,"hasAlpha",void 0);let Xr=class extends Fe{constructor(){super(...arguments),this.overlayIndex=k.INNER,this.opacity=1}};function Fa(){const e=new ee;return e.include(At),e.fragment.uniforms.add(new U("tex",t=>t.texture)),e.fragment.uniforms.add(new it("overlayIdx",t=>t.overlayIndex)),e.fragment.uniforms.add(new Je("opacity",t=>t.opacity)),e.fragment.main.add(w`vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;`),e}const Ea=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:Xr,build:Fa},Symbol.toStringTag,{value:"Module"}));let Rr=class extends K{constructor(t,r){super(t,r,new Z(Ea,()=>J(()=>import("./ImageMaterial.glsl-COuETN4q.js").then(i=>i.O),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76]))))}},V=class extends Hs{constructor(e){super(e),this._overlays=null,this._renderTargets=null,this._overlayParameters=new Xr,this.hasHighlights=!1,this._hasWater=!1,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new yi,this._passParameters=new jr,this._materials=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._camera=new st,this.events=new wi,this.longitudeCyclical=null,this.produces=new Map([[E.DRAPED_MATERIAL,t=>t!==D.Highlight||this.hasHighlights],[E.DRAPED_WATER,()=>this._hasWater]]),this._hasTargetWithoutRasterImage=!1,this._hasDrapedFeatureSource=!1,this._hasDrapedRasterSource=!1}initialize(){const e=this._view,t=e._stage,r=t.renderer.fboCache,{waterTextures:i,textures:a}=t.renderView;this._renderContext=new Ta(this._rctx,new Ra(r,e.state.viewingMode)),this.addHandles([pe(()=>i.updating,()=>this.events.emit("content-changed"),Gt),pe(()=>this.spatialReference,o=>this._localOriginFactory=new Fs(o),Gt),Ci(()=>e.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0),pe(()=>ma(e.state.highlights),()=>this._sortedDrapeSourceRenderersDirty=!0,wt),pe(()=>e.state.highlights,o=>{this._bindParameters.highlights=o,this._bindParameters.highlightOrderMap=e.state.highlightOrderMap,this._updateHighlights()},wt),e.resourceController.scheduler.registerTask(bi.STAGE,this)]),this._materials=new ya(a,this._techniques,()=>{this.notifyChange("rendersOccludedDraped"),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")},()=>this.events.emit("content-changed"));const{_bindParameters:s,_camera:n}=this;n.near=1,n.far=1e4,n.relativeElevation=null,s.slot=E.DRAPED_MATERIAL,s.mainDepth=null,s.camera=n,s.oitPass=Ke.NONE,s.updateLighting([new Ki(Ti())],0,0,rt.Immediate)}destroy(){this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._passParameters.texture=Qe(this._passParameters.texture),this.disposeOverlays()}get _bindParameters(){return this._renderContext.bind}get _rctx(){return this._stage.renderView.renderingContext}get _view(){return this.parent.view}get _stage(){return this.parent.view._stage}get spatialReference(){return this.parent.spatialReference}get _techniques(){return this._stage.renderView.techniques}get rctx(){return this._rctx}get materials(){return this._materials}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}get pluginContext(){return this._pluginContext}initializeRenderContext(e){this._pluginContext=e,this._techniques.precompile(Rr)}uninitializeRenderContext(){}acquireTechniques(){return[]}render(){}get updating(){return this._sortedDrapeSourceRenderersDirty||Ce(this._renderers,e=>e.updating)}get hasOverlays(){return this._overlays!=null&&this._renderTargets!=null}getMaterialRenderer(e){for(const t of this._renderers.values()){const r=t.getMaterialRenderer(e);if(r)return r}return null}get layers(){return this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers(),this._sortedRenderers.map(e=>e.drapeSource.layer).filter(e=>!!e)}_updateHighlights(){const e=this._view.state;this._renderers.forEach(t=>t.updateHighlights(e.highlightOrderMap))}createDrapeSourceRenderer(e,t,r){const i=this._renderers.get(e);i!=null&&i.destroy();const a=new t({...r,rendererContext:this,drapeSource:e});return this._renderers.set(e,a),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this.addHandles(pe(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),a}removeDrapeSourceRenderer(e){if(e==null)return;const t=this._renderers.get(e);t!=null&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this.removeHandles(e),t.destroy())}computeValidity(){var e;return((e=this._renderTargets)==null?void 0:e.computeValidity())??0}releaseRenderTargets(){var e;(e=this._renderTargets)==null||e.dispose()}get overlays(){return this._overlays??[]}ensureDrapeTargets(e){this._hasTargetWithoutRasterImage=!!this._overlays&&ct(e,t=>t.drapeTargetType===Es.WithoutRasterImage)}ensureDrapeSources(e){this._overlays?(this._hasDrapedFeatureSource=ct(e,t=>t.drapeSourceType===He.Features),this._hasDrapedRasterSource=ct(e,t=>t.drapeSourceType===He.RasterImage)):this._hasDrapedFeatureSource=this._hasDrapedRasterSource=!1}get _needsColorWithoutRasterImage(){return this._hasDrapedRasterSource&&this._hasDrapedFeatureSource&&this._hasTargetWithoutRasterImage}ensureOverlays(e,t,r=this._bindParameters.overlayStretch){this._overlays==null&&(this._renderTargets=new Gs(this._stage.renderer.fboCache),this._overlays=[new ar,new ar]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t),this._bindParameters.overlayStretch=r}disposeOverlays(){this._overlays=null,this._renderTargets=Qe(this._renderTargets),this.events.emit("textures-disposed")}getTexture(e){var t,r;if(e!=null)return e===C.ColorNoRasterImage&&!this._needsColorWithoutRasterImage&&this._hasDrapedFeatureSource?(t=this._renderTargets)==null?void 0:t.getTexture(C.Color):(r=this._renderTargets)==null?void 0:r.getTexture(e)}get running(){return this.updating}runTask(e){this._processDrapeSources(e,()=>!0)}_processDrapeSources(e,t){let r=!1;for(const[i,a]of this._renderers){if(e.done)break;(i.destroyed||t(i))&&a.commitChanges(this._view.state.highlightOrderMap)&&(r=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,r=!0,this._updateSortedDrapeSourceRenderers()),r&&(this._overlays!=null&&this._renderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this.hasHighlights=Ce(this._renderers,i=>i.hasHighlights),this.notifyChange("rendersOccludedDraped"))}hasHighlightOptions(e){return Ce(this._renderers,t=>t.hasHighlightOptions(e))}processSyncDrapeSources(){this._processDrapeSources(Oi,e=>e.updatePolicy===Ms.SYNC)}get isEmpty(){return!_t.OVERLAY_DRAW_DEBUG_TEXTURE&&!Ce(this._renderers,e=>!e.isEmpty)}get hasWater(){const e=Ce(this._renderers,t=>t.hasWater);return e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water")),this._hasWater}get rendersOccludedDraped(){const e=this._renderContext.renderOccludedMask;this._renderContext.renderOccludedMask=yt,++this._techniques.precompiling;const t=this._sortedRenderers.some(({renderer:r})=>r.precompile(this._renderContext));return--this._techniques.precompiling,this._renderContext.renderOccludedMask=e,t}renders(e){if(_t.OVERLAY_DRAW_DEBUG_TEXTURE&&e!==C.Occluded&&e!==C.Highlight)return!0;++this._techniques.precompiling;const t=this._sortedRenderers.some(({renderer:r})=>r.precompile(this._renderContext));return--this._techniques.precompiling,t}get mode(){var e;return this.isEmpty?ve.Disabled:this.hasWater&&this.renders(C.WaterNormal)?ve.EnabledWithWater:(e=this._renderTargets)!=null&&e.getTexture(C.Color)?ve.Enabled:ve.Disabled}updateAnimation(e){let t=!1;return this._renderers.forEach(r=>t=r.updateAnimation(e)||t),t&&this.parent.requestRender(Oe.BACKGROUND),t}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}precompileShaders(e){if(this._renderTargets){this._bindParameters.alignPixelEnabled=e.alignPixelEnabled,++this._techniques.precompiling;for(const t of this._renderTargets.targets){if(t.content===C.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)continue;const r=t.output;this._renderContext.output=r,this._bindParameters.slot=r===D.Normal?E.DRAPED_WATER:E.DRAPED_MATERIAL,t.content===C.Occluded&&(this._renderContext.renderOccludedMask=yt),this._sortedRenderers.forAll(({drapeSource:i,renderer:a})=>{t.content===C.ColorNoRasterImage&&i.drapeSourceType===He.RasterImage||a.precompile(this._renderContext)}),this._renderContext.renderOccludedMask=Ye}--this._techniques.precompiling}}drawOverlays(e){if(this._overlays&&this._renderTargets){for(const t of this._overlays)this.longitudeCyclical?t.setupGeometryViewsCyclical(this.longitudeCyclical):t.setupGeometryView();this._bindParameters.alignPixelEnabled=e.alignPixelEnabled;for(const t of this._renderTargets.targets){if(t.content===C.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)continue;const r=this._drawTarget(k.INNER,t),i=this._drawTarget(k.OUTER,t);(r||i)&&t.fbo.generateMipMap()}}}_drawTarget(e,t){const r=this._overlays[e],i=r.canvasGeometries;if(i.numViews===0)return!1;const a=this._view.state.contentPixelRatio;this._screenToWorldRatio=a*r.mapUnitsPerPixel/this._bindParameters.overlayStretch;const s=t.output;if(this.isEmpty||s===D.Normal&&!this.hasWater||!r.hasSomeSizedView())return!1;const{_rctx:n,_camera:o,_renderContext:l,_bindParameters:c}=this;if(o.pixelRatio=r.pixelRatio*a,l.output=s,c.screenToWorldRatio=this._screenToWorldRatio,c.screenToPCSRatio=this._screenToWorldRatio*this.parent.worldToPCSRatio,c.slot=s===D.Normal?E.DRAPED_WATER:E.DRAPED_MATERIAL,t.content===C.Occluded&&(l.renderOccludedMask=yt),!this.renders(t.content))return l.renderOccludedMask=Ye,!1;const{resolution:u}=r,_=e===k.INNER?0:u;if(n.setViewport(_,0,u,u),this._bindTargetFBO(t),e===k.INNER&&(n.setClearColor(0,0,0,0),n.clear(ne.COLOR)),_t.OVERLAY_DRAW_DEBUG_TEXTURE&&t.content!==C.Occluded&&t.content!==C.Highlight){this._techniques.precompile(Or,It);const T=this._techniques.get(Or,It);for(let g=0;g<i.numViews;g++)this._setViewParameters(i.extents[g],r),this._ensureDebugPatternResources(r.resolution,La[e]),n.bindTechnique(T,c,this._passParameters),n.screen.draw()}if(t.output===D.Highlight){const{fboCache:T}=this._stage.renderer,g=this._resolution;this._bindTargetFBO(t),xa(n,T,{width:g,height:g},c,()=>this._renderAllGeometry(e,t),_)}else this._renderAllGeometry(e,t);return n.bindFramebuffer(null),l.renderOccludedMask=Ye,!0}_renderAllGeometry(e,t){const r=this._overlays[e],i=r.canvasGeometries;this._sortedRenderers.forAll(({drapeSource:a,renderer:s})=>{if(t.content===C.ColorNoRasterImage&&a.drapeSourceType===He.RasterImage)return;const{fullOpacity:n}=a,o=n!=null&&n<1&&t.output===D.Color&&this._bindTemporaryFBO();for(let l=0;l<i.numViews;l++)this._setViewParameters(i.extents[l],r),s.render(this._renderContext);if(o){this._bindTargetFBO(t),this._overlayParameters.texture=o.getTexture(),this._overlayParameters.opacity=n,this._overlayParameters.overlayIndex=e;const l=this._techniques.get(Rr);this._rctx.bindTechnique(l,this._bindParameters,this._overlayParameters),this._rctx.screen.draw(),o.release()}})}_bindTargetFBO(e){const t=this._resolution,r=2*t;e.fbo.bind(this._rctx,r,t)}_bindTemporaryFBO(){const e=this._resolution,t=2*e,r=this._stage.renderer.fboCache,i=r.acquire(t,e,"overlay tmp");return r.rctx.bindFramebuffer(i.fbo),r.rctx.clear(ne.COLOR),i}get _resolution(){var e;return((e=this._overlays)==null?void 0:e[k.INNER].resolution)??0}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,t,r,i){var s;this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers();let a=0;for(const{renderer:n}of this._sortedRenderers)a=((s=n.intersect)==null?void 0:s.call(n,e,t,r,i,a))??a}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),this._renderers.size===0)return;const e=this._view.map.allLayers,t=e.length;this._renderers.forEach((r,i)=>{const a=e.indexOf(i.layer),s=a>=0,n=i.renderGroup??(s?Jt.MapLayer:Jt.ViewLayer),o=t*n+(s?a:0);this._sortedRenderers.push(new Ma(i,r,o))}),this._sortedRenderers.sort((r,i)=>r.index-i.index)}_setViewParameters(e,t){const r=this._camera;r.viewport=[0,0,t.resolution,t.resolution],Ri(r.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],r.near,r.far),Si(r.viewMatrix,[-e[0],-e[1],0])}_ensureDebugPatternResources(e,t){if(Mr(this._passParameters.color,t[0],t[1],t[2]),this._passParameters.texture)return;const r=new Uint8Array(e*e*4);let i=0;for(let s=0;s<e;s++)for(let n=0;n<e;n++){const o=Math.floor(n/10),l=Math.floor(s/10);o<2||l<2||10*o>e-20||10*l>e-20?(r[i++]=255,r[i++]=255,r[i++]=255,r[i++]=255):(r[i++]=255,r[i++]=255,r[i++]=255,r[i++]=1&o&&1&l?1&n^1&s?0:255:1&o^1&l?0:128)}const a=new Ir(e);a.samplingMode=Dr.NEAREST,this._passParameters.texture=new xe(this._rctx,a,r)}get test(){}};d([y()],V.prototype,"hasHighlights",void 0),d([y()],V.prototype,"_sortedDrapeSourceRenderersDirty",void 0),d([y({constructOnly:!0})],V.prototype,"parent",void 0),d([y({readOnly:!0})],V.prototype,"_techniques",null),d([y({type:Boolean,readOnly:!0})],V.prototype,"updating",null),d([y()],V.prototype,"isEmpty",null),d([y({readOnly:!0})],V.prototype,"rendersOccludedDraped",null),V=d([Q("esri.views.3d.terrain.OverlayRenderer")],V);class Ma{constructor(t,r,i){this.drapeSource=t,this.renderer=r,this.index=i}}const La=[[1,.5,.5],[.5,.5,1]],Na=-2,yt=ke.OccludeAndTransparent,It=new Yr;It.hasAlpha=!0;let so=class{constructor(t,r={}){this.geometry=t,this.screenToWorldRatio=1,this._transformation=N(),this._shaderTransformation=null,this._boundingSphere=null,this.id=$i(),this.layerUid=r.layerUid,this.graphicUid=r.graphicUid,this.castShadow=r.castShadow??!1,r.objectShaderTransformation&&this.objectShaderTransformationChanged(r.objectShaderTransformation)}get transformation(){return this._transformation}set transformation(t){Ii(this._transformation,t),this._boundingSphere=null}get boundingInfo(){return this.geometry.boundingInfo}objectShaderTransformationChanged(t){t==null?this._shaderTransformation=null:(this._shaderTransformation??(this._shaderTransformation=N()),Ct(this._shaderTransformation,t,this.geometry.transformation)),this._boundingSphere=null}get boundingSphere(){return this.boundingInfo?(this._boundingSphere==null&&(this._boundingSphere??(this._boundingSphere=Ni()),Fr(Hi(this._boundingSphere),this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*Vi(this.shaderTransformation)),this._boundingSphere):Li}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this._shaderTransformation??this.transformation}get attributes(){return this.geometry.attributes}get highlight(){return this.geometry.highlights}foreachHighlightOptions(t){this.geometry.foreachHighlightOptions(t)}get hasHighlights(){return this.geometry.hasHighlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(t){this.geometry.visible=t}};class Ha extends Zi{intersect(t,r,i,a,s,n){return es(t,i,a,s,void 0,n)}}function Va(e){const t=new ee,{vertex:r,fragment:i,attributes:a,varyings:s}=t,{vvColor:n,hasVertexColors:o}=e;return ts(r,e),t.include(rs,e),t.include(is,e),t.include(ss,e),t.include(as,e),i.include(ns,e),t.include(os,e),t.include(ls,e),a.add(x.POSITION,"vec3"),n&&a.add(x.COLORFEATUREATTRIBUTE,"float"),o||s.add("vColor","vec4"),s.add("vpos","vec3"),r.uniforms.add(new hs("uColor",l=>l.color)),r.main.add(w`
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${o?"vColor *= uColor;":n?"vColor = uColor * interpolateVVColor(colorFeatureAttribute);":"vColor = uColor;"}
      forwardViewPosDepth((view * vec4(vpos, 1.0)).xyz);
      gl_Position = transformPosition(proj, view, vpos);`),i.include(cs),i.main.add(w`discardBySlice(vpos);
discardByTerrainDepth();
outputColorHighlightOID(vColor, vpos);`),t}const Wa=Object.freeze(Object.defineProperty({__proto__:null,build:Va},Symbol.toStringTag,{value:"Module"}));class Ua extends K{constructor(t,r){super(t,r,new Z(Wa,()=>J(()=>import("./ImageMaterial.glsl-COuETN4q.js").then(i=>i.C),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76]))))}_createPipeline(t,r){const{oitPass:i,output:a,transparent:s,cullFace:n,draped:o,hasOccludees:l,polygonOffset:c,enableOffset:u}=t,_=i===Ke.NONE,T=i===Ke.FrontFace;return Y({blending:Nr(a)&&s?vs(i):null,culling:Ds(n),depthTest:o?null:{func:ms(i)},depthWrite:fs(t),drawBuffers:a===D.Depth?{buffers:[Di.NONE]}:_s(i,a),colorWrite:X,stencilWrite:l?ps:null,stencilTest:l?r?ds:gs:null,polygonOffset:_||T?c?za:null:us(u)})}initializePipeline(t){return this._occludeePipelineState=this._createPipeline(t,!0),this._createPipeline(t,!1)}getPipeline(t){return t?this._occludeePipelineState:super.getPipeline()}}const za={factor:1,units:1};let F=class extends xs{constructor(){super(...arguments),this.cullFace=Et.None,this.hasVertexColors=!1,this.transparent=!1,this.discardInvisibleFragments=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1,this.draped=!1,this.textureCoordinateType=ys.None,this.emissionSource=ws.None,this.occlusionPass=!1,this.hasVvInstancing=!0,this.vvSize=!1,this.vvOpacity=!1}};d([A({count:Et.COUNT})],F.prototype,"cullFace",void 0),d([A()],F.prototype,"hasVertexColors",void 0),d([A()],F.prototype,"transparent",void 0),d([A()],F.prototype,"discardInvisibleFragments",void 0),d([A()],F.prototype,"polygonOffset",void 0),d([A()],F.prototype,"enableOffset",void 0),d([A()],F.prototype,"writeDepth",void 0),d([A()],F.prototype,"hasOccludees",void 0),d([A()],F.prototype,"terrainDepthTest",void 0),d([A()],F.prototype,"cullAboveTerrain",void 0),d([A()],F.prototype,"objectAndLayerIdColorInstanced",void 0),d([A()],F.prototype,"vvColor",void 0),d([A()],F.prototype,"draped",void 0);let oo=class extends Ha{constructor(t){super(t,ja),this._configuration=new F,this.supportsEdges=!0,this.produces=new Map([[E.OPAQUE_MATERIAL,r=>this._isOpaqueMaterialPass(r)],[E.OPAQUE_MATERIAL_WITHOUT_NORMALS,r=>this._isOpaqueNoSSAODepthPass(r)],[E.TRANSPARENT_MATERIAL,r=>ut(r)&&this._transparent&&this.parameters.writeDepth],[E.TRANSPARENT_MATERIAL_WITHOUT_NORMALS,r=>kt(r)&&this._transparent&&this.parameters.writeDepth],[E.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,r=>ut(r)&&this._transparent&&!this.parameters.writeDepth],[E.DRAPED_MATERIAL,r=>Ui(r)]])}getConfiguration(t,r){return this._configuration.output=t,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._transparent,this._configuration.discardInvisibleFragments=this._transparent&&!this._isOpaquePass(t)&&this.parameters.discardInvisibleFragments,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=r.hasOccludees,this._configuration.oitPass=r.oitPass,this._configuration.enableOffset=r.camera.relativeElevation<Cs,this._configuration.terrainDepthTest=r.terrainDepthTest&&Nr(t),this._configuration.cullAboveTerrain=r.cullAboveTerrain,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.draped=this.parameters.draped,this._configuration}get visible(){return this.parameters.color[3]>=bs}get _transparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}_isOpaquePass(t){return this._isOpaqueMaterialPass(t)||this._isOpaqueNoSSAODepthPass(t)}_isOpaqueMaterialPass(t){return t===D.Highlight||ut(t)&&!this._transparent}_isOpaqueNoSSAODepthPass(t){return kt(t)&&this.parameters.writeDepth&&!this._transparent}createGLMaterial(t){return new qa(t)}createBufferWriter(){const t=Ae().vec3f(x.POSITION);return Hr()&&t.vec4u8(x.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?t.f32(x.COLORFEATUREATTRIBUTE):t.vec4u8(x.COLOR),new Ts(t)}},qa=class extends Rs{beginSlot(t){return this.getTechnique(Ua,t)}};class ja extends Os{constructor(){super(...arguments),this.color=Pr,this.forceTransparentMode=!1,this.writeDepth=!0,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Et.None,this.draped=!1,this.discardInvisibleFragments=!1}}var Sr;(function(e){e[e.EnableFastUpdates=0]="EnableFastUpdates",e[e.DisableFastUpdates=1]="DisableFastUpdates",e[e.UpdateFastLocalOrigin=2]="UpdateFastLocalOrigin"})(Sr||(Sr={}));const S={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},Ga={dash:S.dash,"dash-dot":[...S.dash,...S.dot],dot:S.dot,"long-dash":S["long-dash"],"long-dash-dot":[...S["long-dash"],...S.dot],"long-dash-dot-dot":[...S["long-dash"],...S.dot,...S.dot],none:null,"short-dash":S["short-dash"],"short-dash-dot":[...S["short-dash"],...S["short-dot"]],"short-dash-dot-dot":[...S["short-dash"],...S["short-dot"],...S["short-dot"]],"short-dot":S["short-dot"],solid:null},Ba=8;function ka(e,t){return e==null?e:{pattern:e.slice(),pixelRatio:t}}function co(e){return{pattern:[e,e],pixelRatio:2}}function uo(e){return(e==null?void 0:e.type)==="style"?Ya(e.style):null}function Ya(e){return e!=null?ka(Ga[e],Ba):null}function go(e,t,r=null){const i=[],a=t.mapPositions;Xa(t,i);const s=i[0][1].data,n=i[0][1].indices.length,o=Ps(n);return Qa(t,i,o),Za(t,i,o),Ja(t,i,o),Ka(t,i,o),en(t,i,o),tn(t,i,o),rn(t,i,s),new Ss(e,i,a,$s.Line,r)}function Xa(e,t){const{attributeData:{position:r},removeDuplicateStartEnd:i}=e,a=sn(r)&&i,s=r.length/3-(a?1:0),n=new Array(2*(s-1)),o=a?r.slice(0,-3):r;let l=0;for(let c=0;c<s-1;c++)n[l++]=c,n[l++]=c+1;t.push([x.POSITION,new te(o,n,3,a)])}function Qa(e,t,r){if(e.attributeData.colorFeature!=null)return;const i=e.attributeData.color;t.push([x.COLOR,new te(i??Pi,r,4)])}function Ja(e,t,r){e.attributeData.normal&&t.push([x.NORMAL,new te(e.attributeData.normal,r,3)])}function Ka(e,t,r){e.attributeData.colorFeature!=null&&t.push([x.COLORFEATUREATTRIBUTE,new te([e.attributeData.colorFeature],r,1,!0)])}function Za(e,t,r){e.attributeData.sizeFeature==null&&t.push([x.SIZE,new te([e.attributeData.size??1],r,1,!0)])}function en(e,t,r){e.attributeData.sizeFeature!=null&&t.push([x.SIZEFEATUREATTRIBUTE,new te([e.attributeData.sizeFeature],r,1,!0)])}function tn(e,t,r){e.attributeData.opacityFeature!=null&&t.push([x.OPACITYFEATUREATTRIBUTE,new te([e.attributeData.opacityFeature],r,1,!0)])}function rn(e,t,r){if(e.overlayInfo==null||e.overlayInfo.renderCoordsHelper.viewingMode!==Er.Global||!e.overlayInfo.spatialReference.isGeographic)return;const i=Lr(r.length),a=Ai(e.overlayInfo.spatialReference);for(let _=0;_<i.length;_+=3)Fi(r,_,i,_,a);const s=r.length/3,n=Is(s+1);let o=an,l=nn,c=0,u=0;H(o,i[u++],i[u++]),u++,n[0]=0;for(let _=1;_<s+1;++_)_===s&&(u=0),H(l,i[u++],i[u++]),u++,c+=Ei(o,l),n[_]=c,[o,l]=[l,o];t.push([x.DISTANCETOSTART,new te(n,t[0][1].indices,1,!0)])}function sn(e){const t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}const an=v(),nn=v();function po(e,t,r,i){const a=e.type==="polygon"?Ze.CCW_IS_HOLE:Ze.NONE,s=e.type==="polygon"?e.rings:e.paths,{position:n,outlines:o}=zr(s,!!e.hasZ,a,e.spatialReference),l=Lr(n.length),c=Ls(n,e.spatialReference,0,l,0,n,0,n.length/3,t,r,i),u=c!=null;return{lines:u?Qr(o,n,l):[],projectionSuccess:u,sampledElevation:c}}function _o(e,t){const r=e.type==="polygon"?Ze.CCW_IS_HOLE:Ze.NONE,i=e.type==="polygon"?e.rings:e.paths,{position:a,outlines:s}=zr(i,!1,r),n=Mi(a,e.spatialReference,0,a,t,0);for(let o=2;o<a.length;o+=3)a[o]=Na;return{lines:n?Qr(s,a):[],projectionSuccess:n}}function Qr(e,t,r=null){const i=new Array;for(const{index:a,count:s}of e){if(s<=1)continue;const n=3*a,o=3*s;i.push({position:Bt(t,3*a,3*s),mapPositions:r!=null?Bt(r,n,o):void 0})}return i}const fo=Ae().vec3f(x.POSITION),mo=Ae().vec3f(x.POSITION).vec2f(x.UV0),vo=Ae().vec3f(x.POSITION).vec4u8(x.COLOR),xo=Ae().vec3f(x.POSITION).vec2f(x.UV0).vec4u8(x.OBJECTANDLAYERIDCOLOR);export{oo as A,ea as B,Xr as C,Fa as D,tr as E,Va as F,rr as I,fo as a,go as b,Sr as c,xo as d,Ha as e,mo as f,so as g,Nn as h,co as i,sa as j,Br as k,_o as l,ra as m,uo as n,kn as o,po as p,ae as q,vo as r,tt as s,Na as t,Gr as u,oa as v,ha as w,kr as x,ua as y,jr as z};
